<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MacOS SMS 웹앱</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 사이드바 - 연락처 관리 -->
            <div class="col-md-4 bg-light p-4">
                <h3 class="mb-4">
                    <i class="fas fa-address-book text-primary"></i>
                    연락처 관리
                </h3>
                
                <!-- 연락처 추가 폼 -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-plus text-success"></i>
                            연락처 추가
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- 탭 네비게이션 -->
                        <ul class="nav nav-tabs mb-3" id="addContactTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="manual-tab" data-bs-toggle="tab" data-bs-target="#manual-pane" type="button" role="tab" aria-controls="manual-pane" aria-selected="true">
                                    <i class="fas fa-keyboard"></i> 직접 입력
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="file-tab" data-bs-toggle="tab" data-bs-target="#file-pane" type="button" role="tab" aria-controls="file-pane" aria-selected="false">
                                    <i class="fas fa-file-upload"></i> 파일 업로드
                                </button>
                            </li>
                        </ul>

                        <!-- 탭 내용 -->
                        <div class="tab-content" id="addContactTabsContent">
                            <!-- 직접 입력 탭 -->
                            <div class="tab-pane fade show active" id="manual-pane" role="tabpanel" aria-labelledby="manual-tab">
                                <div class="mb-4">
                                    <h6>한 명씩 추가</h6>
                                    <form id="addContactForm">
                                        <div class="mb-3">
                                            <label for="contactName" class="form-label">이름</label>
                                            <input type="text" class="form-control" id="contactName" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="contactPhone" class="form-label">전화번호</label>
                                            <input type="tel" class="form-control" id="contactPhone" placeholder="010-1234-5678" required>
                                        </div>
                                        <button type="submit" class="btn btn-success w-100">
                                            <i class="fas fa-plus"></i> 추가
                                        </button>
                                    </form>
                                </div>
                                
                                <hr>
                                
                                <div>
                                    <h6>표로 여러명 추가</h6>
                                    <form id="tableContactForm">
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <label class="form-label mb-0">연락처 목록</label>
                                                <div>
                                                    <button type="button" class="btn btn-sm btn-outline-success me-2" id="addTableRowBtn">
                                                        <i class="fas fa-plus"></i> 행 추가
                                                    </button>
                                                    <button type="button" class="btn btn-sm btn-outline-warning" id="clearTableBtn">
                                                        <i class="fas fa-trash"></i> 전체 삭제
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                                <table class="table table-bordered table-sm" id="contactsInputTable">
                                                    <thead class="table-light sticky-top">
                                                        <tr>
                                                            <th style="width: 40%;">이름</th>
                                                            <th style="width: 50%;">전화번호</th>
                                                            <th style="width: 10%;">삭제</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="contactsTableBody">
                                                        <tr>
                                                            <td><input type="text" class="form-control form-control-sm contact-name" placeholder="이름 입력"></td>
                                                            <td><input type="tel" class="form-control form-control-sm contact-phone" placeholder="010-1234-5678"></td>
                                                            <td class="text-center">
                                                                <button type="button" class="btn btn-sm btn-outline-danger delete-row-btn">
                                                                    <i class="fas fa-times"></i>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            <div class="form-text">
                                                <small>
                                                    <i class="fas fa-info-circle text-info"></i>
                                                    <strong>엑셀/구글시트에서 붙여넣기:</strong> 데이터를 복사한 후 첫 번째 이름 칸에 붙여넣으면 자동으로 표에 입력됩니다<br>
                                                    <strong>한글 이름:</strong> UTF-8 지원으로 한글 이름 사용 가능<br>
                                                    <strong>팁:</strong> 빈 행은 자동으로 제외됩니다
                                                </small>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary w-100">
                                            <i class="fas fa-users"></i> 표의 연락처 모두 추가
                                        </button>
                                    </form>
                                </div>
                            </div>

                            <!-- 파일 업로드 탭 -->
                            <div class="tab-pane fade" id="file-pane" role="tabpanel" aria-labelledby="file-tab">
                                <form id="uploadContactForm" enctype="multipart/form-data">
                                    <div class="mb-3">
                                        <label for="contactFile" class="form-label">연락처 파일</label>
                                        <input type="file" class="form-control" id="contactFile" accept=".csv,.md" required>
                                        <div class="form-text">
                                            <small>
                                                <strong>지원 형식:</strong> CSV, MD (마크다운)<br>
                                                <strong>CSV 형식:</strong> 첫 번째 열 이름, 두 번째 열 전화번호<br>
                                                <strong>MD 형식:</strong> 번호→이름(소속) 전화번호 (예: 1→홍길동(회사) 010-1234-5678)<br>
                                                <strong>인코딩:</strong> UTF-8, UTF-8-BOM, CP949 지원 (한글 이름 가능)<br>
                                                <strong>샘플 파일:</strong> sample_contacts.csv (30개 연락처), number.md
                                            </small>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="fas fa-upload"></i> 파일 업로드
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 연락처 목록 (요청에 따라 숨김 처리) -->
                <div class="card" id="contactsCard" style="display: none;">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-list text-info"></i>
                            연락처 목록
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div id="contactsList" class="list-group list-group-flush">
                            <!-- 연락처 목록이 여기에 동적으로 로드됩니다 -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 메인 영역 - SMS 발송 -->
            <div class="col-md-8 p-4">
                <h3 class="mb-4">
                    <i class="fas fa-sms text-primary"></i>
                    SMS 발송
                </h3>
                
                <!-- 수신자 선택 -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-users text-warning"></i>
                            수신자 선택
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <button class="btn btn-outline-primary btn-sm mb-2" id="selectAllBtn">
                                    <i class="fas fa-check-double"></i> 전체 선택
                                </button>
                                <button class="btn btn-outline-secondary btn-sm mb-2 ms-2" id="clearAllBtn">
                                    <i class="fas fa-times"></i> 전체 해제
                                </button>
                            </div>
                        </div>
                        <div id="recipientsList" class="mt-3 recipients-container">
                            <!-- 수신자 체크박스 목록이 여기에 동적으로 로드됩니다 -->
                        </div>
                        <div id="selectedCount" class="mt-3 text-muted d-flex justify-content-between align-items-center">
                            <span>선택된 수신자: <span class="fw-bold">0</span>명</span>
                            <small class="text-info">최대 300px 높이, 스크롤 가능</small>
                        </div>
                    </div>
                </div>
                
                <!-- 메시지 작성 -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-edit text-success"></i>
                            메시지 작성
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="messageText" class="form-label">메시지 내용</label>
                            <textarea class="form-control" id="messageText" rows="5" placeholder="전송할 메시지를 입력하세요..."></textarea>
                            <div class="form-text">
                                <span id="charCount">0</span>/1000자
                            </div>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="button" class="btn btn-primary btn-lg" id="sendSmsBtn">
                                <i class="fas fa-paper-plane"></i>
                                SMS 전송
                            </button>
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-outline-info btn-sm flex-fill" id="testAppleScriptBtn">
                                    <i class="fas fa-cog"></i>
                                    AppleScript 연동 테스트
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" id="closeModalsBtn" title="모든 모달 닫기">
                                    <i class="fas fa-times"></i>
                                </button>
                                <button type="button" class="btn btn-outline-warning btn-sm" onclick="window.location.reload()" title="페이지 새로고침">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 전송 결과 -->
                <div id="sendResults" class="card" style="display: none;">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-bar text-info"></i>
                            전송 결과
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="resultsContent">
                            <!-- 전송 결과가 여기에 표시됩니다 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 로딩 모달 -->
    <div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center p-4">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h5 id="loadingTitle">SMS 전송 중...</h5>
                    <p class="text-muted mb-0" id="loadingMessage">잠시만 기다려주세요.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 파일 업로드 결과 모달 -->
    <div class="modal fade" id="uploadResultModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-file-import text-primary"></i>
                        파일 업로드 결과
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- 업로드 통계 -->
                    <div class="row mb-4" id="uploadStats">
                        <div class="col-md-4">
                            <div class="card border-primary">
                                <div class="card-body text-center">
                                    <i class="fas fa-file-alt fa-2x text-primary mb-2"></i>
                                    <h5 class="text-primary">전체</h5>
                                    <h3 class="mb-0" id="totalParsed">0</h3>
                                    <small class="text-muted">파싱됨</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-success">
                                <div class="card-body text-center">
                                    <i class="fas fa-plus-circle fa-2x text-success mb-2"></i>
                                    <h5 class="text-success">새로운</h5>
                                    <h3 class="mb-0" id="totalNew">0</h3>
                                    <small class="text-muted">연락처</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-warning">
                                <div class="card-body text-center">
                                    <i class="fas fa-exclamation-triangle fa-2x text-warning mb-2"></i>
                                    <h5 class="text-warning">중복</h5>
                                    <h3 class="mb-0" id="totalDuplicates">0</h3>
                                    <small class="text-muted">연락처</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 연락처 미리보기 -->
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-eye text-info"></i>
                                새로운 연락처 미리보기
                            </h6>
                        </div>
                        <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                            <div id="contactPreview">
                                <!-- 연락처 미리보기가 여기에 표시됩니다 -->
                            </div>
                        </div>
                    </div>

                    <!-- 중복 연락처 (있는 경우) -->
                    <div class="card mt-3" id="duplicateCard" style="display: none;">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-exclamation-triangle text-warning"></i>
                                중복된 연락처
                            </h6>
                        </div>
                        <div class="card-body" style="max-height: 200px; overflow-y: auto;">
                            <div id="duplicatePreview">
                                <!-- 중복 연락처가 여기에 표시됩니다 -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-success" id="importContactsBtn">
                        <i class="fas fa-download"></i>
                        <span id="importBtnText">연락처 가져오기</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast 알림 -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toast" class="toast" role="alert">
            <div class="toast-header">
                <i class="fas fa-info-circle text-primary me-2"></i>
                <strong class="me-auto">알림</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastBody">
                <!-- 알림 메시지가 여기에 표시됩니다 -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
